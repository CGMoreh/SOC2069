---
title: "Worksheet 7"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: yes
    toc_highlight: no
    tabset: yes
    number_sections: no
    anchor_sections: no
    self_contained: yes
    code_download: no
    css: ./../my_themes/labcss.css
---

```{r setup, include = FALSE, purl=FALSE}
knitr::knit_hooks$set(purl = knitr::hook_purl)

knitr::opts_chunk$set(error = FALSE, warning=FALSE, comment="", prompt=FALSE, message = F, strip.white = F, fig.width=6, fig.asp = 0.618, fig.show = 'hold')
```

```{r klippy, echo=FALSE, include=TRUE, purl=FALSE}
klippy::klippy(position = c('right'))
```

------------------------------------------------------------------------

    Timetable week: 12
    Topic: "Modelling numeric outcomes 1: single predictors"

------------------------------------------------------------------------

# Intro

One of the most commonly encountered statistical methods in social science publications is **linear regression**. This week we will make some first steps towards understanding what this method involves and applying it in practice using the `R` programming language and data from Wave 8 (2016-2017) of the [UK Household Longitudinal Study (UKHLS/Understanding Society) Main Survey](https://www.understandingsociety.ac.uk/documentation/mainstage).

We'll focus on the simple (*but not trivial!* - as Gelman et al. (2020: 93) admonish) case where we model the relationship between two ***numeric*** (***continuous***) variables using a ***simple linear regression model***. The aim of a **simple linear regression model** is to predict the expected values of one ***continuous*** (***numeric***) variable (e.g. a child's *age)* from another ***continuous*** (***numeric***) variable (e.g. the child's *height)*. The variable we want to predict is usually called the *outcome* (or *dependent* variable) and the variable used for predicting this outcome is referred to as the *predictor* (or *independent* variable).

In actual applied sociological research the *simple linear regression* model is rarely used on its own because we understand that in the social world there are always many factors that influence an outcome at the same time - even in the case of modelling a child's *height*, we know that *age* is an important factor, but there is some considerable variation in height even among children of a similar age, so there must be other factors at work too. We also understand that assuming a strict ***linear*** relationship between two variables is too much of an oversimplification (staying with the *height \~ age* example, while the linear assumption may be realistic when applied to children, it is definitely not applicable if we extend the analysis to all ages: an increase in age is associated with an increase in height for children, but once the age of maturity is reached, we no longer get taller as we get older - in fact, in old age, as we get older we tend to get shorter!).

But the simple linear regression model contains many of the statistical components on which other statistical tests and more complex models are built, so understanding it is essential. We will also learn a few concepts and methods related to simple linear regression - such as *correlation* (also known as the *Pearson correlation,* after the mathematician [Karl Pearson](https://en.wikipedia.org/wiki/Karl_Pearson "Wikipedia")) - and we'll make some steps towards expanding the linear model to include non-continuous predictors. The main `R` function that we will learn is `lm()` (check `help(lm)` for technical information).

# Readings

Core readings:

-   Gelman et al. (2020): Chapters 4, 6 and 7 (pp. 49--67; 81--101)

Secondary readings:

-   Agresti (2018): Chapter 9 (pp. 247--277)
-   Byrne (2002): Chapter 7 (pp. 112--129)

Further readings:

-   Gelman et al. (2020): Chapters 8 and 9 (pp. 103--128)

`r fontawesome::fa("save")` [**Download the module reading pack from here (.zip 47MB)**](https://github.com/CGMoreh/SOC2069/raw/main/readings/soc2069-reading-pack.zip)

# Exercise 0: Setup

1.  **Open the `R Studio` interface** by clicking on the *SOC2069-Statistical-analysis**.Rproj*** file included in the **_SOC2069-Statistical-analysis_** project folder that you downloaded from Canvas in Lab6. The folder should be stored on your Newcastle University **OneDrive** and accessible from any computer

    `r fontawesome::fa("wrench")`   If you haven't yet downloaded the project folder in TW11 (Lab6), then [download it from Canvas](https://ncl.instructure.com/courses/48074/pages/data-access-and-description?module_item_id=2544656). **Tip:** If you haven't completed the Lab6 worksheet, it will be difficult to follow the next steps; please go through *Exercise 1* and *2* of [Lab6](https://cgmoreh.github.io/SOC2069/Worksheets/Lab6)).

2.  **Create a new blank `R` script** for this lab session and call it *Lab7.R*

    `r fontawesome::fa("wrench")` Check *Exercise 1, Task 2* of [*Lab6*](https://cgmoreh.github.io/SOC2069/Worksheets/Lab6)) if you need help with this. **Tip:**
```{r, echo=F, purl=FALSE}
#| out.width="40%",  fig.topcaption = TRUE, fig.align = "center", 

knitr::include_graphics("images/new_script_1.jpg")
```
<center>or</center> 
```{r, echo=F, purl=FALSE}
#| out.width="40%",  fig.topcaption = TRUE, fig.align = "center", 

knitr::include_graphics("images/new_script_2.jpg")
```


3. **Write a comment line** at the top of the new script to briefly detail what the script is about (e.g. *\# Script for Lab x, Week y*). **Tip:** in `R` scripts the hashtag (\#) denotes that the text following it on the same line is just a comment, not a programming command.


3.  **Load user-written `R` packages** we commonly use with the `library()` function

    `r fontawesome::fa("wrench")`   Check *Exercise 1, Task 4* of [*Lab6*](https://cgmoreh.github.io/SOC2069/Worksheets/Lab6) if you need help with this. **Tip:** You may need to first install the package with the `install.packages()` function if it's not yet installed

    ```{r}
    # install.packages(c("tidyverse", "mosaic", "sjmisc")) # If you need to first install the packages, remove the hashtag from in front of the `install.packages()` command to un-comment the command and make it executable in R
    
    library(tidyverse)
    library(mosaic)
    library(sjmisc)
    ```

4.  **Load the *ukhls_w8.rds* dataset** to an object in the session Environment; let's call that object "ukhls" this time

    `r fontawesome::fa("wrench")`   Check *Exercise 1, Task 4* of [*Lab6*](https://cgmoreh.github.io/SOC2069/Worksheets/Lab6)) if you need help with this. **Tip:** Specifying only the file name without a path assumes that you have followed Step 1 above correctly and your working directory is the RProject. If not, go back to Step 1.
    ```{r eval=FALSE}
    ukhls <- readRDS("ukhls_w8.rds")
    ```

```{r include=FALSE, purl=FALSE}
ukhls <- readRDS("./../Data/ukhls_w8.rds")
```



# Exercise 1: Predicting *subjective wellbeing* from *age*

`About 60  minutes`

------------------------------------------------------------------------

For all data analysis tasks, we will follow a "0 + 5"-step workflow. First (**"Step 0"**, because it's not really a separate analytical step), state the research question you are attempting to answer; then (**Step 1**) find and understand variables (data) that help you answer that question; then (**Step 2**) modify (wrangle) any variables that need to be adjusted to help the analysis and interpretation; then (**Step 3**) describe how your *outcome* variables and main *predictor* variable(s) are related. This will help with the interpretation of the statistical results and with identifying any further changes to the variables that may be needed (returning to Step 2 again). You may also wish to check the relationship between your predictor variables if you have more than one (but we're not using multiple predictors yet); then (**Step 4**) apply the statistical model that is most appropriate to answer the "research question"; and finally (**Step 5**) summarise the results from your analysis using tables, figures and your own words. In each exercise, we'll go step-by-step.


## Step 0: Formulate your **"analysis research question"**

The "research question" in this context has a narrow meaning. It doesn't refer to a broad research question like the one you would come up with for a dissertation project, and which may require a combinaiton of different methods and data, but a much more focused - smaller - question.

For example, in this exercise we want to model the relationship between a psychological concept called "subjective wellbeing" and "age". A simple analysis "research question" then is: "How does age affect subjective wellbeing?" The data that we can use to answer this quesiton is a matter for *Step 1*.

:::: {.notebox .note}
**Note**

*Subjective wellbeing* has a large literature. Read [here about how the concept is commonly defined and measured](http://positivepsychology.org.uk/subjective-well-being/). Or check out this [gov.uk](https://www.gov.uk/government/publications/sources-of-wellbeing-data) page on how the concept has been used in UK public policy.
::::


## Step 1: **Find, describe and understand** your variables

In our case, we don't need to find a dataset, because in this module we are only using data from Wave 8 (2016-2017) of the [UK Household Longitudinal Study (UKHLS/Understanding Society) Main Survey](https://www.understandingsociety.ac.uk/documentation/mainstage). You have already loaded that dataset into your RStudio Environment in *Exercise 0* above. You can check the Environment pane in RStudio to make sure that the data is there (recall, we gave it the name "ukhls").

But within our dataset, we need to identify some variables that are appropriate for answering the research question. We know from *Lab6* that we can check the list of variables in our dataset on this page: [https://cgmoreh.github.io/SOC2069/Data/ukhls_w8](https://cgmoreh.github.io/SOC2069/Data/ukhls_w8){target="_blank"}. (**Tip**: you can search for keywords in the usual way: `ctrl+F` on Windows / `command+F` on Mac, and search for "wellbeing"). We can find in our dataset a variable labelled "Subjective wellbeing (GHQ): Likert" and named "**scghq1_dv**". We also have a variable named "**age_dv**" which codes respondents' age as a numeric variable.

We are already familiar with the **age_dv** variable from Lab6 Exercise 3. There, we already looked at basic descriptive statistics and a histogram to *describe* this variable. We should do it again here to remind ourselves. But the **scghq1_dv** is new to us. Let's run the usual descriptive statistics we've learnt in Lab6 to describe our variables.

:::: {.taskbox .task}
### Task 1: Describe **scghq1_dv** and **age_dv** using summary statistics and histograms. 

Write the required commands in the `Lab7.R` script file you created in Exercise 0 and run the commands in the script to get the results.
You can check your `Lab6.R` script file for the commands to use.
**Tip**: remember that we called our data object in RStudio as "ukhls" today, not "data" as we did in Lab6.
::::

:::: {.codingtipbox .codingtip}
**Coding tip**
<details>
  <summary><i>Click to view</i></summary>

In Lab6 we used the base `R` function `summary()` and the `descr()` function from the `{sjmisc}` package to obtain descriptive statistics. We saw that `sjmisc::descr()` allows the so-called 'piped' workflow by which we first state the *data* we are using and the then 'pipe' (` %>% `) it forward to a function. This can be useful as a way to avoid using the `$` operator to select a variable/column of a dataset and instead refer only to the variable/column in the function call; the more substantial benefits are that in the piped workflow we can then do additional procedures on the same data.

There is another workflow option that we can use, which uses a 'formula interface' of the kind we saw in the `histogram()` function from the `{mosaic}` package. This has the advantage that we can memorize the generic form **goal(y ~ x, data = my_data)** that is used in most of the modelling functions in `R` (such as the `lm()` function for **l**inear **m**odelling that we will use later).

The `favstats()` function from the `{mosaic}` package (we already loaded in Exercise 0) uses this form and provides similar descriptive statistics to `summary()`. To use it for describing a hypothetical numeric variable called `x` from a hypothetical dataset called `my_data` we would write:

```{r eval=F, purl=FALSE}
mosaic::favstats( ~ x, data = my_data)
```

</details>
::::

If you've managed Task 1, you should have produced the outputs below (or similar)(**Tip**: the command code is also shown so you can check against your own and copy it if you want):

```{r echo=TRUE, fig.show='asis'}
favstats( ~ age_dv, data = ukhls)
histogram( ~ age_dv, fit = "normal", data = ukhls)
favstats( ~ scghq1_dv, data = ukhls)
histogram( ~ scghq1_dv, fit = "normal", data = ukhls)
```




## Step 2: **Modify** your variables (if needed)


## Step 3: **Describe** the relationship between your variables



## Step 4: **Model** the relationship between your variables



## Step 5: **Present** and **interpret** your findings




# Exercise 2: Explore the Understanding Society Wave 8 dataset

`About 15 minutes`

------------------------------------------------------------------------

# Exercise 3: Basic descriptive statistics

`About 30 minutes`

------------------------------------------------------------------------

# Exercise 4: On your own
