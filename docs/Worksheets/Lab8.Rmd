---
title: "Worksheet 8"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: yes
    toc_highlight: no
    tabset: yes
    number_sections: no
    anchor_sections: no
    self_contained: yes
    code_download: no
    css: ./../my_themes/labcss.css
---

```{r, include=FALSE, purl=FALSE}
options(repos = list(CRAN="http://cran.rstudio.com/"))
```


```{r setup, include = FALSE, purl=FALSE}
# knitr::knit_hooks$set(purl = knitr::hook_purl)

knitr::opts_chunk$set(error = FALSE, warning=FALSE, comment="", prompt=FALSE, message = F, strip.white = F, fig.width=6, fig.asp = 0.618, fig.show = 'hold')
```

```{r klippy, echo=FALSE, include=TRUE, purl=FALSE}
pacman::p_load_gh("rlesur/klippy"); klippy(position = c('right'))
```

------------------------------------------------------------------------

    Timetable week: 13
    Topic: "Modelling numeric outcomes 2: multiple predictors"
    New `R` packages/commands: `jtools::summ()`

------------------------------------------------------------------------

```{r, include=FALSE}
### ---- Lab 8 script ---- ###
```



# Intro

Last week we've learnt how to write a simple linear regression model to assess the statistical relationship between two ***numeric*** (***continuous***) variables. The aim of the **simple linear regression model** is to predict the expected values of one ***continuous*** (***numeric***) variable (e.g. a child's *age*) from another ***continuous*** (***numeric***) variable (e.g. the child's *height)*. This week we begin expanding this basic approach into more complex models by considering some changes to the *predictor* (*independent*) variable. **First**, we look at what happens if our aim is to model variation in a *numeric* outcome variable from a *dichotomous* (*binary*) predictor variable (e.g. **yes**/**no** answers, a binary *sex* variable, etc.); **Then**, we look at examples where the *predictor* variable is *categorical*, with more than just two categories; **Finally**, we add several *pradictor* variables into the model to account for the combined effect of those several factors on our *outcome* of interest.

For continuity, we will make use of some of the variables from previous weeks, from the same data from Wave 8 (2016-2017) of the [UK Household Longitudinal Study (UKHLS/Understanding Society) Main Survey](https://www.understandingsociety.ac.uk/documentation/mainstage).

# Readings

Core readings:

- Gelman et al. (2020): Chapter 10 and Appendix B (pp. 131–150; 493–496)
 

Secondary readings:

- Agresti (2018): Chapters 10–11 (pp. 287–337)
 

Further readings:

- Gelman et al. (2020): Chapters 11 and 12 (pp. 153–211)
- Agresti (2018): Chapters 12–14 (pp. 351–450)

`r fontawesome::fa("save")` [**Download the module reading pack from here (.zip 47MB)**](https://github.com/CGMoreh/SOC2069/raw/main/readings/soc2069-reading-pack.zip)

# Exercise 0: Setup

1.  **Open the `R Studio` interface** by clicking on the *SOC2069-Statistical-analysis**.Rproj*** file included in the **_SOC2069-Statistical-analysis_** project folder that you downloaded from Canvas in Lab6. The folder should be stored on your Newcastle University **OneDrive** and accessible from any computer

    `r fontawesome::fa("wrench")`   If you haven't yet downloaded the project folder in TW11 (Lab6), then [download it from Canvas](https://ncl.instructure.com/courses/48074/pages/data-access-and-description?module_item_id=2544656). **Tip:** If you haven't completed the Lab6 worksheet, it will be difficult to follow the next steps; please go through *Exercise 1* and *2* of [Lab6](https://cgmoreh.github.io/SOC2069/Worksheets/Lab6)).

2.  **Create a new blank `R` script** for this lab session and call it *Lab8.R*

    `r fontawesome::fa("wrench")` Check *Exercise 1, Task 2* of [*Lab6*](https://cgmoreh.github.io/SOC2069/Worksheets/Lab6)) if you need help with this. **Tip:**
```{r, echo=F, purl=FALSE}
#| out.width="40%",  fig.topcaption = TRUE, fig.align = "center", 

knitr::include_graphics("images/new_script_1.jpg")
```
<center>or</center> 
```{r, echo=F, purl=FALSE}
#| out.width="40%",  fig.topcaption = TRUE, fig.align = "center", 

knitr::include_graphics("images/new_script_2.jpg")
```


3. **Write a comment line** at the top of the new script to briefly detail what the script is about (e.g. *\# Script for Lab x, Week y*). **Tip:** in `R` scripts the hashtag (*\#*) denotes that the text following it on the same line is just a comment, not a programming command.


3.  **Load user-written `R` packages** we commonly use with the `library()` function

    `r fontawesome::fa("wrench")`   Check *Exercise 1, Task 4* of [*Lab6*](https://cgmoreh.github.io/SOC2069/Worksheets/Lab6) if you need help with this. **Tip:** You may need to first install the package with the `install.packages()` function if it's not yet installed
```{r include=FALSE}
##### Load packages ----------
```

    ```{r}
# If you need to first install the packages, remove the hashtag 
#   from in front of the `install.packages()` command to un-comment it 
#   and run it

# install.packages(c("tidyverse", "mosaic", "sjmisc"))     
    
    library(tidyverse)
    library(mosaic)
    library(sjmisc)
    ```
    
    ```{r eval=F}
# We'll also install a new package that contains some nice functions 
#   for better formatted table outputs and graphing of regression models   

install.packages("jtools")
library(jtools)
    ```


4.  **Load the *ukhls_w8.rds* dataset** to an object in the session Environment; let's call that object "ukhls":
```{r include=FALSE}
##### Read in data ----------
```
    ```{r eval=FALSE}
    ukhls <- readRDS("ukhls_w8.rds")
    ```
    `r fontawesome::fa("wrench")`   Check *Exercise 1, Task 4* of [*Lab6*](https://cgmoreh.github.io/SOC2069/Worksheets/Lab6)) if you need help with this. **Tip:** Specifying only the file name without a path assumes that you have followed Step 1 above correctly and your working directory is the RProject. If not, go back to Step 1.
    
    <span style="color:red">`r fontawesome::fa("wrench")`   If you have accidentally overwritten the original dataset with incorrect transformations to variables, you can download the original dataset again from here: </span> **[https://cgmoreh.github.io/SOC2069/SOC2069-Statistical-analysis/ukhls_w8.rds](https://cgmoreh.github.io/SOC2069/SOC2069-Statistical-analysis/ukhls_w8.rds)**. <span style="color:red">Save it to the project folder, replacing the old dataset.</span>


```{r include=FALSE, purl=FALSE}
ukhls <- readRDS(url("https://cgmoreh.github.io/SOC2069/SOC2069-Statistical-analysis/ukhls_w8.rds"))
```

# Exercise 1: The effect of *gender* on *subjective wellbeing*

`About 60  minutes`

------------------------------------------------------------------------

We will follow the same "0 + 5"-step workflow as in **Lab7**. First (**"Step 0"**), state the research question; then (**Step 1**) find and understand variables (data) that help you answer that question; then (**Step 2**) modify (wrangle) any variables that need to be adjusted to help the analysis and interpretation; then (**Step 3**) describe how your *outcome* variables and main *predictor* variable(s) are related. This will help with the interpretation of the statistical results and with identifying any further changes to the variables that may be needed (returning to Step 2 again). You may also wish to check the relationship between your predictor variables if you have more than one; then (**Step 4**) apply the statistical model that is most appropriate to answer the "research question"; and finally (**Step 5**) summarise the results from your analysis using tables, figures and your own words. In each exercise, we'll go step-by-step.


## Step 0: Formulate your **"research question"** 

The title of the exercise is almost a reasonable sounding research question. We want to understand: _"Does *gender* have an effect on *subjective wellbeing*"? Or, formulated differently: "Are there any *gender*-based differences in *subjective wellbeing*? Or: "Are *women* happier than men?".

All of these are similar in their aim and the methods required to answer then, but choosing one over the other means that we need to pay attention to how we interpret our results and formulate our answers later on.

## Step 1: **Find, describe and understand** your variables
```{r include=FALSE}
##### Step 1: Selecting variables ----------
```

Last week (see **Lab7**) we got to know how *subjective wellbeing* is defined and operationalised, and which variable in our UKHLS dataset measures it: **scghq1_dv**. 

The other variable we need to answer our question is one that measures respondents' *gender*. We have a variable in the dataset called **sex** that best approximates this (we'll disregard conceptual differences between *sex* and *gender* here; we could have used *sex* instead of *gender* in our research question to be more precise, but that would have sounded a bit awkward and probably changed its meaning completely `r fontawesome::fa("face-smile")`).

We have already looked at the **sex** variable in **Lab6, Task 3.1**. So there's nothing new that we need to do here, but let's look again at some descriptive statistics for these two variables:

:::: {.notebox .note}
**Note**

You have already loaded the UKHLS dataset into your RStudio Environment in *Exercise 0* above. You can check the Environment pane in RStudio to make sure that the data is there (recall, we gave it the name "ukhls").

Remember, you can check the list of variables in the dataset on this page: [https://cgmoreh.github.io/SOC2069/Data/ukhls_w8](https://cgmoreh.github.io/SOC2069/Data/ukhls_w8){target="_blank"}. (**Tip**: you can search for keywords in the usual way: `ctrl+F` on Windows / `command+F` on Mac, and search for "wellbeing").
::::

:::: {.taskbox .task}
```{r eval=F, purl=FALSE}
### Complete the code below

# Descriptive statistics for 'scghq1_dv':

...

# Descriptive statistics for 'sex':

...

```
```{r include=FALSE, fig.show='asis'}
##### Student task: descriptive stats ----------

# Any of the commands below, with or without the 'package::' call becasue the packages should already be loaded

summary(ukhls$scghq1_dv)
 # or #
mosaic::favstats( ~ scghq1_dv, data = ukhls)
 # or #
ukhls %>% sjmisc::descr(scghq1_dv)

histogram( ~ scghq1_dv, data = ukhls)
histogram( ~ scghq1_dv, fit = "normal", data = ukhls) # with a normal distribution superimposed

sjmisc::frq(ukhls$sex)
  # or #
ukhls %>% sjmisc::frq(sex)

# or in base R; but with much less useful information without additional arguments; just in case there are errors loading packages #
summary(ukhls$sex)
summary(ukhls$sex) %>% prop.table()
```
::::

::: {.questionbox .question}
**Questions**

Examine the descriptive results from the tables and charts you've produced and answer:

- What is the average (mean) subjective wellbeing score of the respondents in the dataset?
- What does it mean to have a score of 32 on the *scghq1_dv* scale? **Tip:** In Lab7 we checked what exactly the *scghq1_dv* variable measures by cross-checking on [the UKHLS/Understanding Society website](https://www.understandingsociety.ac.uk/documentation/mainstage/dataset-documentation/variable/scghq1_dv){target="_blank"}.
- Are there more women or men in the dataset?
- What is the percentage of women in the dataset?
- Do we need to transform/recode any of the variables? If so, why and how?
:::

## Step 2: **Modify** your variables (if needed)

In Lab7 we recoded the values on the **scghq1_dv** variable so that *higher* values would equate *higher* subjective wellbeing. This just makes the interpretation of the variable more logical. We also renamed it to **wellbeing** just becasue the original variable name is ugly and a bother to type. We can quickly do that again here (**tip**: check *Lab7, Ex1, Step2* for more explanation):
```{r}
# extract the highest value (check in the Environment if the extracted value is correct)
maxvalue <- max(ukhls$scghq1_dv, na.rm = TRUE)    

# reverse the scale
ukhls <- ukhls %>% 
  mutate(wellbeing = maxvalue - scghq1_dv)  

# quickly compare the two variables to make sure the recoding was correct
ukhls %>% 
  select(scghq1_dv, wellbeing) %>% 
  summary() 

# We should get this output:
```


## Step 3: **Describe** the relationship between your variables

In this step we'll learn something (relatively) new. When we described the relationship between two numeric variables (*wellbeing* and *age*) in Lab7, we did it using a *scatterplot* to which we added a *linear regression fit line* (a.k.a. a *line of best fit*, *least squares line*; see **Agresti (2018: 250-255)**, **Gelman et al.(2020: 86-87**)). 

Using a *scatterplot* to visualise the linear relationship between a **dichotomous**(**binary**) variable (**sex**) and the **numeric** variable **wellbeing** is not the best approach, but it can be done. 

### *Scatterplots* with fit line

```{r}
xyplot(wellbeing ~ sex, type = c("p", "r"), data = ukhls)
```

As with the *wellbeing* by *age* scatterplot in Lab7, the reason why it doesn't look great is that the *wellbeing* scale is rather small (0-36 )


### Comparative *boxplots*

```{r}
boxplot(wellbeing ~ sex, data = ukhls, horizontal = T)
bwplot(wellbeing ~ sex, data = ukhls, pch = "|")
```

:::{.notebox .note}
**Note:**

In a `bwplot` if we inverse the order of the variables and place our categorical (factor, dichotomous) variable first, we get a horizontal graph; sometimes it make the visual comparison of the variables easier:

```{r}
bwplot(sex ~ wellbeing, data = ukhls, pch = "|")

boxplot(sex ~ wellbeing, data = ukhls, horizontal = T)

```

:::

```{r include=FALSE}
##### Step x ----------
```

## Step 4: **Model** the relationship between your variables

```{r include=FALSE}
##### Step 4: Linear modeling ----------
```

## Step 5: **Present** and **interpret** your findings
# Exercise 2: On your own

------------------------------------------------------------------------

::: {.taskbox .task}
**Task**

Find some other numeric variables whose relationship can be modelled using a linear regression and undertake a complete analysis like the one in Exercise 1. 

There aren't too many useful numeric variables in the UKHLS dataset, so you'll have to work with what you have to come up with interesting "research questions" to answer. 

This is also what you'll be required to do in Assignment 2, so your time and effort will not be wasted!

:::


```{r eval=FALSE, include=F, purl=FALSE}
# Just run this chunk manually at the end...
knitr::purl("Lab8.Rmd", documentation = 0)
```




















