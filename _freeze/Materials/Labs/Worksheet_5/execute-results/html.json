{
  "hash": "a83ee11869099e3f9b36aa5c2068953f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Worksheet 5\"\nsubtitle: \"Modelling interactions in R\"\nformat: \n  # docx: default # word doc in docs already edited a bit\n  html: \n    code-link: true\n    embed-resources: true\n    fig-align: center\n    # fig-width: 5\n    # fig-asp: .8\n    # fig-responsive: true\n    code-overflow: wrap\n    code-tools:\n      source: false # add URL to script document to be downloaded\n      toggle: false\n      caption: none\nexecute: \n  warning: false\n  error: false\n  echo: true\n  purl: false\nknitr: \n  opts_chunk: \n    comment: \"\"\n    prompt: false\n    message: false\n    strip.white: false\ncss: labcss.css\nbibliography: references.bib\n---\n\n\n------------------------------------------------------------------------\n\n```         \nTimetable week: 7\nTopic: \"Interaction models\"\n```\n\n------------------------------------------------------------------------\n\n# Learning outcomes\n\nBy the end of the session you will know how to:\n\n-   You will learn how to fit, visualise and interpret results from regression models that include interaction terms.\n\n# Introduction\n\nSo far, we have only considered so-called *additive* models, in which each explanatory (predictor; independent) variable is assumed to have an effect on the outcome (explained; predicted; dependent) variable that is independent of the values of other explanatory variables included in the model.\nWe call these effects (i.e. the coefficients associated with each predictor) \"main effects\".\nA useful reminder in ***R*** that a model is *additive* is the fact that we enter explanatory variables in the regression code separated by a **+** sign (e.g. trust \\~ education **+** age).\n\nOf course, we know that in real life effects are never \"additive\" in this sense; the effect of an explanatory variable is always *dependent* to some degree on the values of the other explanatory variables included in the model.\nMost often, however, these dependencies (what we can call *interactions* between various explanatory variables) are rather weak and modelling them would significantly complicate the interpretability of our models - the main advantage of regression models is that they are able to reduce complex associations between various aspects of social life to simple coefficients (the \"main effects\") that are good enough to enable some practical conclusions to be drawn.\nIn other words, regression modelling is an act of simplification with the aim of drawing conclusions that are accurate enough for practical purposes.\n\nAt the same time, some of these *dependencies* are strong enough to warrant complicating a regression model by including them; or they may be the main focus of an investigation, for example if we are testing/building a theory about \"intersectionality\".\nAs @ConnellyEtAl2016ModellingKeyVariables \\[p. 11\\] explain, \"examining the ***interactions*** between variables that identify multiple characteristics of individuals (e.g. their gender, ethnicity and social class) is a methodological strategy for examining intersectionality\" (emphasis added) [see also @BlockEtAl2023-07-01EvaluatingClaimsIntersectionality].\n\nIn an interaction model, we reject the assumption of additivity and are interested in exploring whether an explanatory variable has a different effect on the outcome depending on the values of other explanatory variables.\nThe relationship between the outcome variable and the interacted explanatory variables will become *multiplicative*.\nAgain, in ***R***, a useful reminder that a model is *multiplicative* in this sense is the use of the **\\*** sign for specifying an interaction in code.\nFor the hypothetical example above, we can include an interaction term between education and age (e.g. trust \\~ education + age + education**\\***age) to find out whether age has a different effect on trust depending on one's level of education (or vice-versa).\nWe may find, for instance, that among those with high education higher age is associated with higher levels of trust, whereas among those with lower education levels higher age is associated with lower levels of trust.\nThis is just a fictitious example, but it demonstrates the types of questions we are able to ask and answer using interaction models.\nIn this lab we will look at some interaction models in practice.\n\n# Exercise 0: Setup\n\n1.  **Open the `R Studio` interface** by clicking on the ***.Rproj*** file included in the project folder that you created in *Lab2*.\n    The folder should be stored on your Newcastle University **OneDrive** and accessible from any computer.\n\n2.  **Create a new blank Quarto document for this lab session and call it *Lab5.qmd***\n\n3.  At the top of the page briefly detail what the script is about (e.g. \"Lab work for Week x\").\n\n4.  **Load `R` packages** that we will use in this session\n\n::: {.codebox .code}\n**An alternative function to install and load packages in one go**\n\nTo simplify the process of loading packages *and* installing them if they are missing from your computer, the `{pacman}` package provides a set of functions, of which `p_load()` is the most useful.\n\n`p_load()` takes as arguments unquoted package names and does what `library()` does; however, if the package is not yet installed, it will first automatically call `install.packages()` on the package name, then do the `library()` call.\nThis functionality can come in very handy if one is often using different computers where `R` packages need to be installed again and again.\nFurthermore, `{pacman}` also provides for downloading packages not hosted on the official `CRAN` repository, but instead available on popular private repositories such as the *GitHub* platform, using the `p_install_gh()` function, which takes as arguments a quoted text string of the GitHub username and the package name, separated by `/` (e.g. `p_install_gh(\"strengejacke/strengejacke\")`).\n\nFirst, install `{pacman}` the standard way:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"pacman\")          # needs to be \"quoted\"\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\npackage 'pacman' successfully unpacked and MD5 sums checked\n\nThe downloaded binary packages are in\n\tC:\\Users\\cgmoreh\\AppData\\Local\\Temp\\RtmpQHNSta\\downloaded_packages\n```\n\n\n:::\n:::\n\n\nThen load/install+load multiple packages as:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, easystats, gtsummary, ggformula, ggeffects, sjlabelled, marginaleffects)\n```\n:::\n\n\nOf course, it's always useful to list each package in a separate line to increase readability and maybe add comments on the packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse,             # metapackage; general data management (especially the `dplyr` package)\n               easystats,             # metapackage; data management and model summaries\n               gtsummary,             # data and model summary tables\n               ggformula,             # formula syntax to simplify `ggplot2` graphics\n               sjlabelled,            # work with labelled survey data from other statistical packages\n               ggeffects,             # extract and plot marginal/conditional/interaction effects from models\n               marginaleffects        # extract and plot marginal/conditional/interaction effects from models\n               )\n```\n:::\n\n:::\n\n# Exercise 1: Are preferences for redistribution associated with education in European countries, and is the association moderated by social trust?\n\n`About 30  minutes`\n\n------------------------------------------------------------------------\n\nThe research question asked in the title of this exercise relates directly to the research reported by @Akaeda2023TrustEducationalGap.\nFollowing a detailed review of the literature on the relationship between attitudes towards redistribution, education, and social- and institutional trust, the author derives a hypothesis that they want to investigate: \"trust decreases the gap in preferences for redistribution due to education\" (p. 296).\nThey break down the hypothesis into two parts, one relating *social* trust and the other to *institutional* trust.\n\n@Akaeda2023TrustEducationalGap combine data from several waves (years) of the World Values Survey (WVS) and the European Values Study (EVS) to test this research hypothesis.\nTheir combined dataset contains data on \"74 countries, 26 years, 259 country-years, and 254,214 individuals\".\nTheir interest is in modelling the hypothesised relationship on a global level, accounting both for various individual explanatory variables as well as macro-social factors at the level of countries and country-years (i.e. change over time within countries).\n\nOur aim in this exercise is more modest, but we will attempt to fit a smaller version of their \"Model 3\" (reported in *Table 2*).\nIn terms of data, our exercise task focuses specifically on \"European\" countries; for this purpose, we will use data from the latest wave of the EVS (download the data and read the codebook here: <https://soc2069.chrismoreh.com/data/data_main>).\nIn terms of variable selection and transformations, we will roughly follow @Akaeda2023TrustEducationalGap, with some adjustments for convenience.\n@Akaeda2023TrustEducationalGap [pp. 297-298] describe their variable selection procedure in these words:\n\n> -   the ***dependent*** variable is the **score of preferences for redistribution**. This score is based on a question ... that asks respondents to indicate **on a scale from 1 to 10** whether **'Incomes should be made more equal (1)'** or **'We need larger income differences as incentives for individual effort (10)'**. In accordance with previous research, **the scores were reversed** such that a higher score indicates stronger support for redistribution;\n> -   the **level of education** is a ***key independent variable*** because the association between education and support for redistribution is a main focus of this study. Because previous studies have shed light on the mechanisms of university education related to a conservative view of redistribution, this analysis adopts **the dummy for university or higher degree** as an independent variable;\n> -   as a ***key moderator variable*** ... **social trust** as measured by the question, 'Generally speaking, would you say that most people can be trusted or that you need to be very careful in dealing with people?', which had the following two potential responses: '1. Most people can be trusted', '2. Need to be very careful'. Based on previous research involving social trust, this analysis employs **the dummy for social trust** (**1 = 'Most people can be trusted'**);\n> -   the following individual-level ***controls***: **gender** (1 = female, 0= male), **age**, **age squared**, **employment status** (*employed, self-employed, unemployed, retired, other*), **household income** (z scored for country-year units, **marital status** (married = 1), **child** (having child = 1), and **political orientation** (1 = right to 10 = left)\n\n## Step 0-2: Data management\n\nUsing functions that we are already familiar with from Lab 4, we import and transform the data as needed:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\n# Make sure to download the EVS dataset to your local folder (from here: https://soc2069.chrismoreh.com/data/data_main)\n\n# Import the EVS data to R:\n\nevs <- readRDS(\"D:/GitHub/SOC2069/Data/for_analysis/evs2017.rds\")\n\n# Select the variables needed for this exercise:\n\nex5.1 <- evs |> \n  select(v106,      # redistribution pref.\n         v243_r,    # education\n         v31,       # social trust\n         v225,      # sex/gender\n         age,\n         v244,      # employment status\n         v261_ppp,  # household income (corrected)\n         v234,      # marital status\n         v239_r,    # number of children\n         v102,      # political orientation (1=left...10=right)\n         )\n\n\n# `View` the codebook for the selected variables:\n\ndata_codebook(ex5.1) |> View()\n\n\n# Recode variables to match Akaeda (2023) as closely as possible:\n\nex5.1 <- ex5.1 |> \n  data_modify(redistribute = reverse(v106),\n              educ_univ = recode_values(v243_r,\n                                   recode = list(\"University degree\" = 3,\n                                                 \"0\" = c(1, 2, 66))),\n              trusting = recode_values(v31,\n                                       recode = list(\"Trusting\" = 1,\n                                                     \"0\" = 2)),\n              female = recode_values(v225,\n                                     recode = list(\"Female\" = 2,\n                                                   \"0\" = 1)),\n              v244 = as_factor(v244),\n              employment = recode_values(v244,\n                                         recode = list(\"Employed\" = c(1, 2), \n                                                       \"Self-employed\" = 3, \n                                                       \"Unemployed\" = 8, \n                                                       \"Retired\" = 5, \n                                                       \"Other\" = c(4, 6, 7, 9, 10))),\n              hh_income = v261_ppp,\n              married = recode_values(v234,\n                                      recode = list(\"Married\" = 1,\n                                                    \"0\" = 2:6)),\n              child = recode_values(v239_r,\n                                    recode = list(\"Has children\" = 1:5)),\n              politics = reverse(v102)\n              )\n\n# `View` the codebook for the recoded dataset:\n\ndata_codebook(ex5.1) |> View()\n```\n:::\n\n\n## Step 3: Describe the relationship between the main variables of interest\n\nFollowing @Akaeda2023TrustEducationalGap, the main variables of interest are `redistribute`, `educ_univ` and `trusting`.\nUsing techniques that we have covered in previous Lab exercises, describe some of the relationships between them using tabulations and graphs:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Describe the relationship between the variables:\n\n```\n:::\n\n\n## Step 4: Fit and interpret a multiple regression model *without* interaction terms\n\nOur dependent variable (`redistribute`) can be treated as *numeric*, so we will fit a linear (ordinary least squares) regression model using the `lm()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm5.1 <- lm(redistribute ~ educ_univ + trusting + female + employment + hh_income + married + child + politics, data = ex5.1)\n```\n:::\n\n\nLet's then check the model coefficients (parameters):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(m5.1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter                     | Coefficient |       SE |         95% CI | t(40050) |      p\n-------------------------------------------------------------------------------------------\n(Intercept)                   |        4.05 |     0.05 | [ 3.95,  4.15] |    77.35 | < .001\neduc univ [University degree] |       -0.50 |     0.03 | [-0.56, -0.44] |   -16.51 | < .001\ntrusting [Trusting]           |        0.30 |     0.03 | [ 0.25,  0.36] |    10.12 | < .001\nfemale [Female]               |        0.14 |     0.03 | [ 0.09,  0.20] |     5.12 | < .001\nemployment [Other]            |    5.89e-03 |     0.05 | [-0.09,  0.10] |     0.12 | 0.901 \nemployment [Retired]          |        0.09 |     0.04 | [ 0.02,  0.16] |     2.62 | 0.009 \nemployment [Self-employed]    |       -0.21 |     0.06 | [-0.33, -0.09] |    -3.54 | < .001\nemployment [Unemployed]       |       -0.20 |     0.06 | [-0.31, -0.09] |    -3.58 | < .001\nhh income                     |        0.03 | 7.73e-03 | [ 0.01,  0.04] |     3.53 | < .001\nmarried [Married]             |       -0.16 |     0.03 | [-0.22, -0.09] |    -4.96 | < .001\nchild [Has children]          |       -0.12 |     0.04 | [-0.19, -0.05] |    -3.30 | < .001\npolitics                      |        0.24 | 6.01e-03 | [ 0.22,  0.25] |    39.30 | < .001\n```\n\n\n:::\n:::\n\n\n::: {.questionbox .question}\n**Discuss with the person sitting next to you**\n\nHow would you interpret the effect of *education* and of *social trust* on *redistributive attitudes based on this model?*\n:::\n\n## Step 5: Re-fit the model with an interaction between *education* and *social trust*\n\nWe can include an interaction between two variables in a regression model by including their \"multiplication\" using the \"\\*\" operator:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm5.1x <- lm(redistribute ~ educ_univ + trusting + educ_univ*trusting + female + employment + hh_income + married + child + politics, data = ex5.1)\n```\n:::\n\n\nLet's then check the model coefficients (parameters):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(m5.1x)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter                                           | Coefficient |       SE |         95% CI | t(40049) |      p\n-----------------------------------------------------------------------------------------------------------------\n(Intercept)                                         |        4.13 |     0.05 | [ 4.02,  4.23] |    77.15 | < .001\neduc univ [University degree]                       |       -0.68 |     0.04 | [-0.76, -0.60] |   -17.06 | < .001\ntrusting [Trusting]                                 |        0.15 |     0.04 | [ 0.07,  0.22] |     3.86 | < .001\nfemale [Female]                                     |        0.14 |     0.03 | [ 0.09,  0.20] |     5.00 | < .001\nemployment [Other]                                  |   -1.39e-03 |     0.05 | [-0.09,  0.09] |    -0.03 | 0.976 \nemployment [Retired]                                |        0.09 |     0.04 | [ 0.02,  0.16] |     2.47 | 0.013 \nemployment [Self-employed]                          |       -0.21 |     0.06 | [-0.33, -0.10] |    -3.59 | < .001\nemployment [Unemployed]                             |       -0.21 |     0.06 | [-0.32, -0.10] |    -3.82 | < .001\nhh income                                           |        0.02 | 7.75e-03 | [ 0.01,  0.04] |     2.94 | 0.003 \nmarried [Married]                                   |       -0.15 |     0.03 | [-0.22, -0.09] |    -4.90 | < .001\nchild [Has children]                                |       -0.12 |     0.04 | [-0.20, -0.05] |    -3.48 | < .001\npolitics                                            |        0.24 | 6.01e-03 | [ 0.22,  0.25] |    39.14 | < .001\neduc univ [University degree] × trusting [Trusting] |        0.41 |     0.06 | [ 0.29,  0.52] |     6.98 | < .001\n```\n\n\n:::\n:::\n\n\nWe can compare our results with those reported in *Model 3* (Table 2) of @Akaeda2023TrustEducationalGap, keeping in mind that our data are very different.\nNonetheless, we find a similar positive effect for the interaction term (0.41), which in our case is stronger.\n\n## Interpreting interactions\n\nAs with results from *logistic regression* models, interpreting interaction results is not straightforward.\n\nFirst of all, the coefficients associated with the individual variables included in the interaction term can no longer be interpreted in the usual direct way, and we usually no longer interpret the \"main effects\" of `educ_univ` and `trusting`, but only the multiplicative effect of the interaction between them.\nThe interpretation of the numeric results, however, is rather convoluted and prone to lead to misinterpretations.\nIn essence, what we get is the effect of a unit-change in trust among the university-educated **compared to** the effect of a unit-change in trust among the non-university-educated.\n\nAs with interpreting *logistic regression*, it can be much easier and reliable to interpret a plot of the \"marginal effects\".\nAs we already know from Lab 4, that can be achieved using the `ggpredict()` and the `plot()` functions, and we would add both constitutive terms of the interaction.\nDepending on which variable we write first we get either the effect of trust *by* education, or the effect of education *by* trust:\n\nEducation by trust:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpredict(m5.1x, terms = c(\"educ_univ\", \"trusting\")) |> \n  plot()\n```\n\n::: {.cell-output-display}\n![](Worksheet_5_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nTrust by education:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpredict(m5.1x, terms = c(\"trusting\", \"educ_univ\")) |> \n  plot()\n```\n\n::: {.cell-output-display}\n![](Worksheet_5_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nThe latter plot reproduces *Figure 1* from @Akaeda2023TrustEducationalGap.\nTo get an even closer reproduction of that Figure, we could add an additional argument to the plotting function, asking for the point-predictions to be connected with lines:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpredict(m5.1x, terms = c(\"trusting\", \"educ_univ\")) |> \n  plot(connect.lines = TRUE)\n```\n\n::: {.cell-output-display}\n![](Worksheet_5_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nLooking at whether and how much the *confidence intervals* of the predicted coefficients overlap with the point-predictions of the coefficients, we can visually asses the interaction effect.\nWe find that positive differences in the level of social trust have a much steeper effect on *redistributive attitudes* among the highly educated than it does among the lower educated.\n\n::: {.questionbox .question}\n**Practice interpretation**\n\nHow does @Akaeda2023TrustEducationalGap discuss their findings in respect to *social trust*?\nRead the relevant sections in the journal article and attempt to write down our own findings along those lines.\n:::\n\n# Exercise 2: Are anti-immigrant attitudes associated with lower social trust, and is the association dependent on gender, financial insecurity or authoritarian inclinations?\n\n`About 30  minutes`\n\n------------------------------------------------------------------------\n\nYou will notice that the first part of the question exactly replicates the research question posed in *Exercise 3* of Worksheet 3.\nGo back to that exercise and refit it here.\nThen, refit it three times, each time including a separate interaction between *anti-immigrant attitudes* and *gender*, *financial insecurity* and *authoritarian inclination*s, respectively.\nInterpret the results and compare your models.\n\nYou should use the following variables from the European Social Survey (ESS) for *financial insecurity* and *authoritarian inclinations*:\n\n|         |                                           |\n|:--------|:------------------------------------------|\n| hincfel | Feeling about household's income nowadays |\n\n|         |                                                              |\n|:--------|:-------------------------------------------------------------|\n| accalaw | Acceptable for country to have a strong leader above the law |\n\n# Exercise 3: How does education relate to social trust in Great Britain, and is the relationship dependent on income?\n\n`About 30  minutes`\n\n------------------------------------------------------------------------\n\nYou will notice that the first part of the question exactly replicates the research question posed in *Exercise 2* of *Worksheet 4*.\nAs in the previous exercise, fit the model as described there, then re-fit it by also including an interaction between *education* and *income*.\nVisualise and interpret the results by combining what you now know about the interpretation of logistic regressions (Lab 4) and of interaction terms.\n",
    "supporting": [
      "Worksheet_5_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}