
# European Values Study (2017)

This dataset comes from the [European Values Study 2017 (EVS 2017)](https://search.gesis.org/research_data/ZA7500?doi=10.4232/1.13897). The data (Version 5.0.0) was downloaded in SPSS format from the GESIS repository and save to the `raw/evs2017/` folder:


```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false

fs::dir_info("raw/evs2017", glob = c("*.zip", "*.sav", "*.pdf"))[, c(1,3)] |> gt::gt_preview() |> gt::cols_align(align = "left") |> gt::tab_options(table.width = "70%")

```

The SOC2069 version of the dataset can be reproduced from the raw data file with the `R` code shown in the expandable field below.

```{r}
#| warning: false
#| output: false
#| code-fold: true
#| code-summary: "Show the code"

## Packages (install first if needed) ----------------------------------------------------------------------------------------

library(datawizard)

## Path to file --------------------------------------------------------------------------------------------------------------

filepath <- "raw/evs2017/ZA7500_v5-0-0.sav.zip"

## Read in the data file -----------------------------------------------------------------------------------------------------

evs2017 <- data_read(filepath) |> 
  drop_labels() |>
  remove_empty_columns() |> 
  data_select(-c(studyno:fw_end, c_abrv, mode:fmissings, v228b:v229,
                 v231b, v231b_r, v233b, v233b_r, v242_r:v243_8cat,
                 v243_cs_DE1:v243_cs_GB2,v245:v248a,
                 v251b_r:v252_8cat, v252_cs_DE1:v252_cs_GB2,
                 v254:v258, v262_edulvlb:v262_8cat,
                 v262_cs_DE1:v263_8cat, v263_cs_DE1:v243_r_weight,
                 starts_with("f"),
                 ends_with("_IT", "_DK", "_cs", "_SE", "a", "b", "c"))
              )

## Save the dataset as .rds for SOC2069 --------------------------------------------------------------------------------------

data_write(evs2017, "for_analysis/evs2017.rds")

```

If you use the EVS2017 data in your work, cite it as follows:

 > EVS (2022). European Values Study 2017: Integrated Dataset (EVS 2017). GESIS, Cologne. ZA7500 Data file Version 5.0.0, https://doi.org/10.4232/1.13897.

## EVS2017 Codebook

```{r}
#| echo: false
#| message: false
#| warning: false

library(dplyr)
library(sjlabelled)

## The `datawizard::data_read()` function already transforms variables into factors more efficiently than `sjlabelled::read_spss()`, but for the `data_codebook()` we would like to have the Values listed as well as the Value Labels, so we need to transform the factors back to numeric and then into factors again.
## This is a bit different compared to importing with `sjlabelled::read_spss()`, when we would do:
  # drop_labels() |>
  # mutate(across(where(is.factor), 
  #               as_numeric) |> 
  #               as_label()) 


`SOC2069: European Values Study, 2017` <- evs2017 |> 
  mutate(across(where(is.factor), 
                as_numeric) |> 
                as_factor()
         )

`SOC2069: European Values Study, 2017` |> 
    data_codebook(variable_label_width = 60, 
                  value_label_width = 35,
                  max_values = 10,
                  range_at = 5) |> 
    print_html(font_size = "80%",
               line_padding = 0)
```