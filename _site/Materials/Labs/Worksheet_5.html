<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HOME - Worksheet 9</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../..//site_pics/SOC2069_logo_noaxis.png" rel="icon" type="image/png">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="labcss.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">HOME</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../Structure.html" rel="" target="">
 <span class="menu-text">Module structure</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Materials/Labs/Worksheet_1.html" rel="" target="">
 <span class="menu-text">Week 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Materials/Labs/Worksheet_2.html" rel="" target="">
 <span class="menu-text">Week 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ttt" rel="" target="">
 <span class="menu-text">Week 3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Materials/Labs/Worksheet_4.html" rel="" target="">
 <span class="menu-text">Week 4</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../Materials/Labs/Worksheet_5.html" rel="" target="" aria-current="page">
 <span class="menu-text">Week 5</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ttt" rel="" target="">
 <span class="menu-text">Week 6</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ttt" rel="" target="">
 <span class="menu-text">Week 7</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ttt" rel="" target="">
 <span class="menu-text">Week 8</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ttt" rel="" target="">
 <span class="menu-text">Week 9</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ttt" rel="" target="">
 <span class="menu-text">Week 10</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ttt" rel="" target="">
 <span class="menu-text">Assessment</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://ncl.instructure.com/courses/53153" rel="" target=""><i class="bi bi-house-lock" role="img" aria-label="Canvas page (Newcastle University login required)">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">Intro</a></li>
  <li><a href="#readings" id="toc-readings" class="nav-link" data-scroll-target="#readings">Readings</a></li>
  <li><a href="#exercise-0-setup" id="toc-exercise-0-setup" class="nav-link" data-scroll-target="#exercise-0-setup">Exercise 0: Setup</a></li>
  <li><a href="#exercise-1-what-factors-influence-smoking-behaviour" id="toc-exercise-1-what-factors-influence-smoking-behaviour" class="nav-link" data-scroll-target="#exercise-1-what-factors-influence-smoking-behaviour">Exercise 1: What factors influence smoking behaviour?</a>
  <ul class="collapse">
  <li><a href="#step-0-formulate-your-research-question" id="toc-step-0-formulate-your-research-question" class="nav-link" data-scroll-target="#step-0-formulate-your-research-question">Step 0: Formulate your <strong>“research question”</strong></a></li>
  <li><a href="#step-1-find-describe-and-understand-your-variables" id="toc-step-1-find-describe-and-understand-your-variables" class="nav-link" data-scroll-target="#step-1-find-describe-and-understand-your-variables">Step 1: <strong>Find, describe and understand</strong> your variables</a></li>
  <li><a href="#step-2-modify-your-variables-if-needed" id="toc-step-2-modify-your-variables-if-needed" class="nav-link" data-scroll-target="#step-2-modify-your-variables-if-needed">Step 2: <strong>Modify</strong> your variables (if needed)</a></li>
  <li><a href="#step-3-describe-the-relationship-between-your-variables" id="toc-step-3-describe-the-relationship-between-your-variables" class="nav-link" data-scroll-target="#step-3-describe-the-relationship-between-your-variables">Step 3: <strong>Describe</strong> the relationship between your variables</a>
  <ul class="collapse">
  <li><a href="#boxplots-to-compare-group-medians" id="toc-boxplots-to-compare-group-medians" class="nav-link" data-scroll-target="#boxplots-to-compare-group-medians"><em>Boxplots</em> to compare group medians</a></li>
  <li><a href="#crosstabulations-the-xtabs-function" id="toc-crosstabulations-the-xtabs-function" class="nav-link" data-scroll-target="#crosstabulations-the-xtabs-function">Crosstabulations: the <code>xtabs()</code> function</a></li>
  <li><a href="#crosstabulations-the-flat_table-function-from-sjmisc" id="toc-crosstabulations-the-flat_table-function-from-sjmisc" class="nav-link" data-scroll-target="#crosstabulations-the-flat_table-function-from-sjmisc">Crosstabulations: the <code>flat_table()</code> function from <code>{sjmisc}</code></a></li>
  </ul></li>
  <li><a href="#step-4-model-the-relationship-between-your-variables" id="toc-step-4-model-the-relationship-between-your-variables" class="nav-link" data-scroll-target="#step-4-model-the-relationship-between-your-variables">Step 4: <strong>Model</strong> the relationship between your variables</a>
  <ul class="collapse">
  <li><a href="#from-log-odds-to-odds-ratios" id="toc-from-log-odds-to-odds-ratios" class="nav-link" data-scroll-target="#from-log-odds-to-odds-ratios">From <strong><em>log-odds</em></strong> to <strong><em>Odds Ratios</em></strong></a></li>
  </ul></li>
  <li><a href="#exercise-2-make-it-simple" id="toc-exercise-2-make-it-simple" class="nav-link" data-scroll-target="#exercise-2-make-it-simple">Exercise 2: Make it simple</a></li>
  <li><a href="#exercise-3-on-your-own" id="toc-exercise-3-on-your-own" class="nav-link" data-scroll-target="#exercise-3-on-your-own">Exercise 3: On your own</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Worksheet 9</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<hr>
<pre><code>
Timetable week: 14
Topic: "Modelling binary outcomes: logistic regression"
</code></pre>
<hr>
<section id="intro" class="level1">
<h1>Intro</h1>
<div class="cell" data-layout-align="center" data-source-line-numbers="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1          5.1         3.5          1.4         0.2  setosa
2          4.9         3.0          1.4         0.2  setosa
3          4.7         3.2          1.3         0.2  setosa
4          4.6         3.1          1.5         0.2  setosa
5          5.0         3.6          1.4         0.2  setosa</code></pre>
</div>
</div>
<p>This worksheet introduces a new type of regression model: <em>(binary) logistic regression</em>.</p>
<p>The logistic regression model attempts to <strong>predict the probability that an observation falls into one of two categories of a dichotomous dependent (outcome) variable</strong> based on one or more independent (predictor) variables that can be either continuous (numeric) or categorical (“factors” in <code>R</code>, whether categories are ordered or not).</p>
<p>In many ways, logistic regression is like linear regression, except for the measurement type of the dependent variable (i.e., linear regression uses a numeric dependent variable rather than a dichotomous one). However, unlike in linear regression, <strong>you are not attempting to determine the predicted value</strong> of the dependent variable, <strong>but the <em>probability</em> of being in a particular category</strong> of the dependent variable given the independent variables. An observation is assigned to whichever category is predicted as most likely.</p>
<p>A logistic regression is thus based on the fact that the outcome has only two possible values: 0 or 1. Often, 1 is used to denote a “case” whereas 0 is then a “non-case”. (E.g. Is someone a smoker? Yes=‘the case’, or ‘true’, No=‘non-case’, or ‘false’). Logistic regression is used to predict the “odds” of being a “case” based on the values of the x-variable(s). Just as for linear regression analysis, we get a <strong>coefficient</strong> (the ‘<strong>log of the odds</strong>’) that <strong>shows the effect of x on y</strong>. However, because logistic regression is based on other assumptions than linear regression, we cannot interpret these coefficients very easily. Instead, we focus on something called the “<strong>odds ratio</strong>” (OR). The “<strong>odds ratio</strong>” can never be negative – it can range between 0 and infinity, with the value <strong>1</strong> representing <strong>equal odds</strong> (i.e.&nbsp;no effect - just like <strong>0</strong> represented ‘no effect’ in linear regression). What the OR actually stands for – and whether we can say that an effect is small or big – depends on the values of x and y. The OR can be further transformed into probabilities, which are standardised values (i.e.&nbsp;between 0 and 1, and as such convertible to a percentage between 0% and 100%). and are easier to interpret.</p>
<p>We will use the same data from Wave 8 (2016-2017) of the <a href="https://www.understandingsociety.ac.uk/documentation/mainstage">UK Household Longitudinal Study (UKHLS/Understanding Society) Main Survey</a>.</p>
</section>
<section id="readings" class="level1">
<h1>Readings</h1>
<p>Core readings:</p>
<ul>
<li>Gelman et al.&nbsp;(2020): Chapter 13 (pp.&nbsp;217–237)</li>
</ul>
<p>Secondary readings:</p>
<ul>
<li>Gelman et al.&nbsp;(2020): Chapter 14 (pp.&nbsp;241–259)</li>
<li>Agresti (2018): Chapter 15 (pp.&nbsp;459–488)</li>
</ul>
<p>Further readings:</p>
<ul>
<li>Gelman et al.&nbsp;(2020): Chapter 16 (pp.&nbsp;291–310)</li>
</ul>
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M48 96V416c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V170.5c0-4.2-1.7-8.3-4.7-11.3l33.9-33.9c12 12 18.7 28.3 18.7 45.3V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96C0 60.7 28.7 32 64 32H309.5c17 0 33.3 6.7 45.3 18.7l74.5 74.5-33.9 33.9L320.8 84.7c-.3-.3-.5-.5-.8-.8V184c0 13.3-10.7 24-24 24H104c-13.3 0-24-10.7-24-24V80H64c-8.8 0-16 7.2-16 16zm80-16v80H272V80H128zm32 240a64 64 0 1 1 128 0 64 64 0 1 1 -128 0z"></path></svg> <a href="https://github.com/CGMoreh/SOC2069/raw/main/readings/soc2069-reading-pack.zip"><strong>Download the module reading pack from here (.zip 47MB)</strong></a></p>
</section>
<section id="exercise-0-setup" class="level1">
<h1>Exercise 0: Setup</h1>
<ol type="1">
<li><p><strong>Open the <code>R Studio</code> interface</strong> by clicking on the <em>SOC2069-Statistical-analysis<strong>.Rproj</strong></em> file included in the <strong><em>SOC2069-Statistical-analysis</em></strong> project folder that you downloaded from Canvas in Lab6. The folder should be stored on your Newcastle University <strong>OneDrive</strong> and accessible from any computer</p>
<p><svg aria-hidden="true" role="img" viewbox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M352 320c88.4 0 160-71.6 160-160c0-15.3-2.2-30.1-6.2-44.2c-3.1-10.8-16.4-13.2-24.3-5.3l-76.8 76.8c-3 3-7.1 4.7-11.3 4.7H336c-8.8 0-16-7.2-16-16V118.6c0-4.2 1.7-8.3 4.7-11.3l76.8-76.8c7.9-7.9 5.4-21.2-5.3-24.3C382.1 2.2 367.3 0 352 0C263.6 0 192 71.6 192 160c0 19.1 3.4 37.5 9.5 54.5L19.9 396.1C7.2 408.8 0 426.1 0 444.1C0 481.6 30.4 512 67.9 512c18 0 35.3-7.2 48-19.9L297.5 310.5c17 6.2 35.4 9.5 54.5 9.5zM80 408a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"></path></svg> If you haven’t yet downloaded the project folder in TW11 (Lab6), then <a href="https://ncl.instructure.com/courses/48074/pages/data-access-and-description?module_item_id=2544656">download it from Canvas</a>. <strong>Tip:</strong> If you haven’t completed the Lab6 worksheet, it will be difficult to follow the next steps; please go through <em>Exercise 1</em> and <em>2</em> of <a href="https://cgmoreh.github.io/SOC2069/Worksheets/Lab6">Lab6</a>).</p></li>
<li><p><strong>Create a new blank <code>R</code> script</strong> for this lab session</p>
<p><svg aria-hidden="true" role="img" viewbox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M352 320c88.4 0 160-71.6 160-160c0-15.3-2.2-30.1-6.2-44.2c-3.1-10.8-16.4-13.2-24.3-5.3l-76.8 76.8c-3 3-7.1 4.7-11.3 4.7H336c-8.8 0-16-7.2-16-16V118.6c0-4.2 1.7-8.3 4.7-11.3l76.8-76.8c7.9-7.9 5.4-21.2-5.3-24.3C382.1 2.2 367.3 0 352 0C263.6 0 192 71.6 192 160c0 19.1 3.4 37.5 9.5 54.5L19.9 396.1C7.2 408.8 0 426.1 0 444.1C0 481.6 30.4 512 67.9 512c18 0 35.3-7.2 48-19.9L297.5 310.5c17 6.2 35.4 9.5 54.5 9.5zM80 408a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"></path></svg> Check <em>Exercise 1, Task 2</em> of <a href="https://cgmoreh.github.io/SOC2069/Worksheets/Lab6"><em>Lab6</em></a>) if you need help with this. <strong>Tip:</strong></p>
<div class="cell" data-layout-align="center" data-fig.topcaption="true">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sheet_pics/new_script_1.jpg" class="img-fluid figure-img" style="width:40.0%"></p>
</figure>
</div>
</div>
</div>
<center>
<p>or</p>
</center>
<div class="cell" data-layout-align="center" data-fig.topcaption="true">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sheet_pics/new_script_2.jpg" class="img-fluid figure-img" style="width:40.0%"></p>
</figure>
</div>
</div>
</div></li>
<li><p><strong>Write a comment line</strong> at the top of the new script to briefly detail what the script is about (e.g.&nbsp;<em># Script for Lab x, Week y</em>). <strong>Tip:</strong> in <code>R</code> scripts the hashtag (<em>#</em>) denotes that the text following it on the same line is just a comment, not a programming command.</p></li>
<li><p><strong>Load user-written <code>R</code> packages</strong> we commonly use with the <code>library()</code> function</p>
<p><svg aria-hidden="true" role="img" viewbox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M352 320c88.4 0 160-71.6 160-160c0-15.3-2.2-30.1-6.2-44.2c-3.1-10.8-16.4-13.2-24.3-5.3l-76.8 76.8c-3 3-7.1 4.7-11.3 4.7H336c-8.8 0-16-7.2-16-16V118.6c0-4.2 1.7-8.3 4.7-11.3l76.8-76.8c7.9-7.9 5.4-21.2-5.3-24.3C382.1 2.2 367.3 0 352 0C263.6 0 192 71.6 192 160c0 19.1 3.4 37.5 9.5 54.5L19.9 396.1C7.2 408.8 0 426.1 0 444.1C0 481.6 30.4 512 67.9 512c18 0 35.3-7.2 48-19.9L297.5 310.5c17 6.2 35.4 9.5 54.5 9.5zM80 408a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"></path></svg> Check <em>Exercise 1, Task 4</em> of <a href="https://cgmoreh.github.io/SOC2069/Worksheets/Lab6"><em>Lab6</em></a> if you need help with this. <strong>Tip:</strong> You may need to first install the package with the <code>install.packages()</code> function if it’s not yet installed</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you need to first install the packages, remove the hashtag </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   from in front of the `install.packages()` command to un-comment it </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   and run it</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("tidyverse", "mosaic", "sjmisc", "jtools"))     </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjmisc)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p><strong>Load the <em>ukhls_w8.rds</em> dataset</strong> to an object in the session Environment; let’s call that object “ukhls”:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ukhls <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ukhls_w8.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><svg aria-hidden="true" role="img" viewbox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M352 320c88.4 0 160-71.6 160-160c0-15.3-2.2-30.1-6.2-44.2c-3.1-10.8-16.4-13.2-24.3-5.3l-76.8 76.8c-3 3-7.1 4.7-11.3 4.7H336c-8.8 0-16-7.2-16-16V118.6c0-4.2 1.7-8.3 4.7-11.3l76.8-76.8c7.9-7.9 5.4-21.2-5.3-24.3C382.1 2.2 367.3 0 352 0C263.6 0 192 71.6 192 160c0 19.1 3.4 37.5 9.5 54.5L19.9 396.1C7.2 408.8 0 426.1 0 444.1C0 481.6 30.4 512 67.9 512c18 0 35.3-7.2 48-19.9L297.5 310.5c17 6.2 35.4 9.5 54.5 9.5zM80 408a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"></path></svg> Check <em>Exercise 1, Task 4</em> of <a href="https://cgmoreh.github.io/SOC2069/Worksheets/Lab6"><em>Lab6</em></a>) if you need help with this. <strong>Tip:</strong> Specifying only the file name without a path assumes that you have followed Step 1 above correctly and your working directory is the RProject. If not, go back to Step 1.</p>
<p><span style="color:red"><svg aria-hidden="true" role="img" viewbox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M352 320c88.4 0 160-71.6 160-160c0-15.3-2.2-30.1-6.2-44.2c-3.1-10.8-16.4-13.2-24.3-5.3l-76.8 76.8c-3 3-7.1 4.7-11.3 4.7H336c-8.8 0-16-7.2-16-16V118.6c0-4.2 1.7-8.3 4.7-11.3l76.8-76.8c7.9-7.9 5.4-21.2-5.3-24.3C382.1 2.2 367.3 0 352 0C263.6 0 192 71.6 192 160c0 19.1 3.4 37.5 9.5 54.5L19.9 396.1C7.2 408.8 0 426.1 0 444.1C0 481.6 30.4 512 67.9 512c18 0 35.3-7.2 48-19.9L297.5 310.5c17 6.2 35.4 9.5 54.5 9.5zM80 408a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"></path></svg> If you have accidentally overwritten the original dataset with incorrect transformations to variables, you can download the original dataset again from here:</span> <a href="https://cgmoreh.github.io/SOC2069/SOC2069-Statistical-analysis/ukhls_w8.rds"><strong>https://cgmoreh.github.io/SOC2069/SOC2069-Statistical-analysis/ukhls_w8.rds</strong></a>. <span style="color:red">Save it to the project folder, replacing the old dataset.</span></p></li>
</ol>
</section>
<section id="exercise-1-what-factors-influence-smoking-behaviour" class="level1">
<h1>Exercise 1: What factors influence smoking behaviour?</h1>
<p><code>About 60  minutes</code></p>
<hr>
<section id="step-0-formulate-your-research-question" class="level2">
<h2 class="anchored" data-anchor-id="step-0-formulate-your-research-question">Step 0: Formulate your <strong>“research question”</strong></h2>
<p>Say we want to find out what are the factors that influence smoking behaviour (i.e.&nbsp;smoking or not smoking). If this is our <strong>research question</strong>, then we need a dependent variable relating to smoking behaviour and some independent variables relating to possible influencing factors.</p>
<p>We know that in the UKHLS (Understanding Society) dataset we have a useful variable relating to smoking, which could serve as the dependent variable (if we search the <a href="https://cgmoreh.github.io/SOC2069/Data/ukhls_w8">data catalogue</a> we find the following variable: <strong><em>smoker</em></strong>, a factor variable with two levels (“yes” and “no”) with relatively few missing values (4.4%). We already see there how the variable is distributed, with the majority of the respondents (85%) being non-smokers.</p>
<p>Now that we know that the variable we want to predict (“smoker”) is a categorical variable with two categories, we know that a linear regression would not be the appropriate method. Instead, the statistical model we should use is the logistic regression.</p>
<p>Now we need to ask ourselves about what independent variables we want to include. These are the variables that can potentially influence smoking behaviour. This is primarily a theoretical question (i.e.&nbsp;thinking logically, or based on our readings of sociological literature, what factors might have an influence on smoking?), but we also need to make sure that any variable (factor) we think of, actually exists in our data-set. So let’s look at our data-set and search for some possible factors.</p>
<p>For this example exercise I propose that we consider the following three variables as our independent variables: <strong><em>sex</em></strong>, <strong><em>age_dv</em></strong> and <strong>finnow</strong> [“Subjective financial situation - current”].</p>
<p><strong><em>If this were your assessment research question</em>, you would start by first examining each variable separately using descriptive statistics, and examining how predictors are associated with the dependent variable using bivariate descriptive statistics. After that, you would want to check how all the factors considered together might influence smoking behaviour, for which a logistic regression is the appropriate method.</strong></p>
</section>
<section id="step-1-find-describe-and-understand-your-variables" class="level2">
<h2 class="anchored" data-anchor-id="step-1-find-describe-and-understand-your-variables">Step 1: <strong>Find, describe and understand</strong> your variables</h2>
<p>We have already practised descriptive statistics a lot, so this step should be easy by now. We also already know how the “age_dv” and “sex” variables look like, but for the sake of practice - as you would also do in your assignment! - let’s run some descriptive statistics on them too. “Smoker” and “finnow” (or “=current financial situation, <em>fin</em>ancial situation <em>now</em>) are new variables to us.</p>
<div class="taskbox task">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Complete the code below</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive statistics for 'sex':</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive statistics for 'age_dv':</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive statistics for 'smoker':</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive statistics for 'finnow':</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="questionbox question">
<p><strong>Questions</strong></p>
<p>Examine the descriptive results from the tables you’ve produced and answer:</p>
<ul>
<li>What is the valid percentage of smokers in the dataset?</li>
<li>What <em>type</em> of variable is <strong>finnow</strong>?</li>
<li>What is the total number of survey respondents who declared that they are finding it quite or very difficult to get by with their available financial resources?</li>
</ul>
</div>
<div class="codebox code">
<p><strong>Coding tip</strong>: Use <code>select()</code> with <code>summary()</code></p>
<p>There’s an easy way to get some quick summary statistics for a selected small number of variables of interest from a dataset. We can first use <code>select()</code> to select out the variables we want, then ask for a <code>summary()</code> on the whole of that selected mini-dataset:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ukhls <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sex, age_dv, smoker, finnow) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>     sex            age_dv        smoker     
 male  :17925   Min.   : 16.00   Yes : 5519  
 female:21368   1st Qu.: 34.00   No  :32058  
                Median : 49.00   NA's: 1716  
                Mean   : 48.77               
                3rd Qu.: 63.00               
                Max.   :102.00               
                        finnow     
 Living comfortably        :12459  
 Doing alright             :14748  
 Just about getting by     : 7570  
 Finding it quite difficult: 1882  
 Finding it very difficult :  800  
 NA's                      : 1834  </code></pre>
</div>
</div>
<p>Note that this only shows basic descriptives, so for example we do not get the percentage distribution of the frequencies in the frequency tables for categorical variables, so we can’t easily answer all the questions above using this.</p>
</div>
</section>
<section id="step-2-modify-your-variables-if-needed" class="level2">
<h2 class="anchored" data-anchor-id="step-2-modify-your-variables-if-needed">Step 2: <strong>Modify</strong> your variables (if needed)</h2>
<p>Now that we know how our variables look like, let’s think: are there any variables that require some modification? Not necessarily, in this case, becasue we don’t have any obvious mistakes or superfluous labels/categories in these variables. We know from previous weeks that recoding the <em>age</em> variable by median-centring it may help with the interpretation of the regression results because then the “Intercept” coefficient would not refer to someone who is aged 0, but to someone who has the median age in our dataset. Because we usually do not need to interpret the “intercept” in multiple regression (with many predictors included in the model), we can leave the <em>age</em> variable as it is for now. The only change that we may want to ponder is whether combining the last two levels/categories of the <em>financial situation</em> variable may be sensible. The reason for this may be because these two levels contain far fewer responses than the other three categories, and it’s always better to have a balanced categorical variable. However, the number of responses in each category is still large enough not to cause statistical complications for the model. The other reason why we may want to collapse the last two categories into one, is that it will make reading the regression output far more manageable. We know from the previous week that if we include a categorical variable as predictor into a regression model, we need to break it down into a series of new binary/dummy variables, one for each level/category. We know that <code>R</code> does this automatically for us if we tell it that our variable is a <em>factor</em> (i.e.&nbsp;categorical), but then in the output we will have quite a few variables to interpret, each with its own regression coefficient. Finally, if we wanted to collapse the last two categories, we could do so because it would make sense conceptually to group together those who are “finding it … difficult”. We may even be able to make an argument that those who are “just about getting by” are closer to those who are finding it difficult than to those who are “doing alright”, and we may decide to collapse the last three categories together. These are all subjective choices for us as data analysts to make. We need to consider both statistical/mathematical criteria (e.g.&nbsp;the number of cases/responses in the various categories) as well as substantive sociological knowledge about the topic (in this, case, self-assessed poverty). Cutting out or collapsing data always means that we are throwing away additional information that could potentially be useful. It’s a trade-off that we need to consider. But as a first step in any analysis, once we have considered what transformations was be possible or necessary, I suggest that you always fit a first model on the complete dataset to get a sense of how the model behaves, and then decide whether any transformation may be preferable. So, for now, we won’t change anything.</p>
</section>
<section id="step-3-describe-the-relationship-between-your-variables" class="level2">
<h2 class="anchored" data-anchor-id="step-3-describe-the-relationship-between-your-variables">Step 3: <strong>Describe</strong> the relationship between your variables</h2>
<p>We have many variables here, so we will need to focus on the most useful comparisons. What we are interested in is how our predictor variables relate to our outcome variable, <strong><em>smoker</em></strong>.</p>
<section id="boxplots-to-compare-group-medians" class="level3">
<h3 class="anchored" data-anchor-id="boxplots-to-compare-group-medians"><em>Boxplots</em> to compare group medians</h3>
<p>We have already practiced describing the relationship between <em>numeric</em> and <em>categorical</em> variables visually using box-plots, and we can apply the same here to compare the median ages of <em>smokers</em> and <em>non-smokers</em> in our dataset:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(age_dv <span class="sc">~</span> smoker, <span class="at">data =</span> ukhls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Worksheet_5_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<div class="questionbox question">
<p><strong>Questions</strong></p>
<ul>
<li>Is the median age of smokers higher than that of non-smokers?</li>
<li>Are there any extreme outliers?</li>
</ul>
</div>
<p>To describe the relationship between two <em>categorical</em> variables, we need to a method we haven’t practiced before: a <strong>cross-tabulation</strong> or <strong>contingency</strong> table. You should be very familiar with these types of tables. They show the distribution of a categorical variable <strong><em>contingent</em></strong> on another categorical variable.</p>
<p>Again, there are several ways to get simple contingency tables and there are numerous functions is various packages that make more complex or nicely formatted contingency tables. For simplicity, we’ll only look at the options available using base-R and the packages we are already familiar with.</p>
</section>
<section id="crosstabulations-the-xtabs-function" class="level3">
<h3 class="anchored" data-anchor-id="crosstabulations-the-xtabs-function">Crosstabulations: the <code>xtabs()</code> function</h3>
<p>Using the base-R function <code>xtabs()</code> we can write:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>( <span class="sc">~</span> smoker <span class="sc">+</span> sex, <span class="at">data =</span> ukhls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>      sex
smoker  male female
   Yes  2706   2813
   No  14062  17996</code></pre>
</div>
</div>
<p>This shows us the frequency distribution of the <em>smoker</em> variable by each category of the <em>sex</em> variable, and vice-versa, depending on whether we read it row-wise or column-wise. If we want to also see the marginal totals (for columns and rows), we can pipe on the table to the <code>addmargins()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>( <span class="sc">~</span> smoker <span class="sc">+</span> sex, <span class="at">data =</span> ukhls) <span class="sc">%&gt;%</span> <span class="fu">addmargins</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>      sex
smoker  male female   Sum
   Yes  2706   2813  5519
   No  14062  17996 32058
   Sum 16768  20809 37577</code></pre>
</div>
</div>
<p>If instead of frequencies we would like to see the proportions (percentages), we can pass the <code>xtabs</code> table on to the <code>prop.table()</code> function, where we should also select whether we are interested in <em>row</em> or <em>column</em> percentages using the <code>margin =</code> option (where <strong>1 stands for rows</strong> and <strong>2 for columns</strong>). It’s up to us to decide which option is best for our analysis. We can do both in turn, because they help us answer different questions.</p>
<p>In general, if we have a clear <em>outcome</em> variable - like <strong>smoker</strong> in our case - then we would want to place its categories in the rows and show the values of the predictor (<strong>sex</strong> in our case) in the columns. If so, then <em>column</em> proportions would tell us the ratio of smokers and non-smokers among women and men, while <em>row</em> percentages would tell us the ratio of men/women among the smokers or non-smokers:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># row proportions:</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>( <span class="sc">~</span> smoker <span class="sc">+</span> sex, <span class="at">data =</span> ukhls) <span class="sc">%&gt;%</span> <span class="fu">prop.table</span>(<span class="at">margin =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>      sex
smoker      male    female
   Yes 0.4903062 0.5096938
   No  0.4386425 0.5613575</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># column proportions:</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>( <span class="sc">~</span> smoker <span class="sc">+</span> sex, <span class="at">data =</span> ukhls) <span class="sc">%&gt;%</span> <span class="fu">prop.table</span>(<span class="at">margin =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>      sex
smoker      male    female
   Yes 0.1613788 0.1351819
   No  0.8386212 0.8648181</code></pre>
</div>
</div>
<p>If we’re annoyed by the many decimals and want to see a cleaner table rounded down to two decimal places, we can pass the <code>prop.table</code> further to a <code>round()</code> function, where we also specify the desired number of decimal places. Let’s say we want to show only 2 decimals (we can also simplify the previous command by not spelling out “margins =” in the command and simply giving it’s value):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>( <span class="sc">~</span> smoker <span class="sc">+</span> sex, <span class="at">data =</span> ukhls) <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>      sex
smoker male female
   Yes 0.49   0.51
   No  0.44   0.56</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>( <span class="sc">~</span> smoker <span class="sc">+</span> sex, <span class="at">data =</span> ukhls) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>      sex
smoker male female
   Yes 0.16   0.14
   No  0.84   0.86</code></pre>
</div>
</div>
<p>If we have row proportions, the values across rows should add up to 1 (i.e.&nbsp;100%); if we have column proportins, then they should add up to 1 vertically, across columns; if they don’t, then we’ve done something wrong. For example, if we do not specify a <code>margin =</code>, then by default the proportions will be calculated per cell (rather than by row or column) respective to the total number of respondents.</p>
<p>If we prefer to convert the proportions to percentages, we can simply multiply the <code>prop.table</code> by 100:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># row proportions</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>( <span class="sc">~</span> smoker <span class="sc">+</span> sex, <span class="at">data =</span> ukhls) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>(<span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>      sex
smoker     male   female
   Yes 49.03062 50.96938
   No  43.86425 56.13575</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># column proportions</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>( <span class="sc">~</span> smoker <span class="sc">+</span> sex, <span class="at">data =</span> ukhls) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>(<span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>      sex
smoker     male   female
   Yes 16.13788 13.51819
   No  83.86212 86.48181</code></pre>
</div>
</div>
</section>
<section id="crosstabulations-the-flat_table-function-from-sjmisc" class="level3">
<h3 class="anchored" data-anchor-id="crosstabulations-the-flat_table-function-from-sjmisc">Crosstabulations: the <code>flat_table()</code> function from <code>{sjmisc}</code></h3>
<p>We’ve already used the <code>{sjmisc}</code> package, and it contains another function that may be useful for crosstabulations: <code>flat_table()</code>. It gives similar results to those above, but the code may be a bit more simple. We just need to list the variables we want to cross-tabulate, separated by commas; to show proportions, we can add an additional argument <code>margin =</code> and choose either “row” or “col” as a value. The results are shown directly as percentages (i.e.&nbsp;proportions * 100) rounded down to two decimals:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sjmisc<span class="sc">::</span><span class="fu">flat_table</span>(smoker, sex, <span class="at">data =</span> ukhls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>       sex  male female
smoker                 
Yes         2706   2813
No         14062  17996</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or as row percentages:</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>sjmisc<span class="sc">::</span><span class="fu">flat_table</span>(smoker, sex, <span class="at">data =</span> ukhls , <span class="at">margin =</span> <span class="st">"row"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>       sex  male female
smoker                 
Yes        49.03  50.97
No         43.86  56.14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or as column percentages:</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>sjmisc<span class="sc">::</span><span class="fu">flat_table</span>(smoker, sex, <span class="at">data =</span> ukhls , <span class="at">margin =</span> <span class="st">"col"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>       sex  male female
smoker                 
Yes        16.14  13.52
No         83.86  86.48</code></pre>
</div>
</div>
<p><strong>The issue</strong> with this function is that it cannot include marginal totals; for that, the <strong>xtabs() %&gt;% addmargins()</strong> option would be the way to go.</p>
<div class="questionbox question">
<p><strong>Questions</strong></p>
<p>So, what have we learned so far about the relationship between sex and smoking behaviours? - Are there more men or women among the non-smokers? - Is the percentage of smokers among men higher or lower than among women?</p>
</div>
<div class="taskbox task">
<p><strong>Task</strong></p>
<p>Using the functions we’ve learnt above, summarise the relationship between <em>smoking</em> behaviour and <em>financial situation</em> using cross-tabulations. <strong>Tip</strong>: because the <em>finnow</em> variable has so many levels (categories), it’s visually better to place it in the rows.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Complete the tasks below:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Contingency table of 'finnow' by 'smoker' showing frequencies and marginal totals</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Contingency table of 'finnow' by 'smoker' showing column percentages:</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Contingency table of 'finnow' by 'smoker' showing column percentages:</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="questionbox question">
<p><strong>Questions</strong></p>
<p>What have we learned about the relationship between subjective financial situation and smoking behaviour? - Among which financial-situation group is the proportion of smokers the highest? - Which financial-situation group has the highest percentage among the smokers? And explain why this is the case, give the answer to the previous question! (<strong>tip</strong>: look again at the frequency contingency table too) - Overall, based on these results, would you say that there is an association between <em>financial situation</em> and <em>smoking</em> behaviour? If so, why do you think that?</p>
</div>
</section>
</section>
<section id="step-4-model-the-relationship-between-your-variables" class="level2">
<h2 class="anchored" data-anchor-id="step-4-model-the-relationship-between-your-variables">Step 4: <strong>Model</strong> the relationship between your variables</h2>
<p>Of course, we need to check whether your answer to the last question above stands up against statistical validation. This is where regression modelling comes in. We can fit three separate bivariate models here, checking in turn the predictive power of each of the three predictor variables, as we have done in previous weeks. Then, our final aim is to fit a model that estimates the effect of <em>financial situation</em> on <em>smoking behaviour</em> while also accounting for the effect of <em>age</em> and <em>sex</em>; that is, a multiple regression with more than a single predictor. In this exercise we will fit the final, full model to get an idea of the overall picture, but you can then check on your own how simpler models with fewer predictors behave.</p>
<p>Our challenge compared to previous weeks is that now our outcome variable of interest, <em>smoker</em>, is not a numeric/scale variable but a dichotomous, categorical one. So the <strong><em>units</em></strong> in which we can measure any effect on this outcome “scale” of 0/1 are no longer that easy to get our heads around. That means that interpreting the results is where the challenge will be.</p>
<p>The actual fitting of the model is fairly simple: we can use the function that fits a <strong>g</strong>eneralised <strong>l</strong>inear <strong>model</strong> (<code>glm()</code>) using similar syntax to that of <strong>l</strong>inear *m**odel (<code>lm()</code>), with the only difference that we should specify which “family” of distributions the outcome variable belongs to; a binary/dichotomous outcome has a so-called “<strong>binomial</strong>” distribution, and that’s what we need to tell <code>R</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>model_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(smoker <span class="sc">~</span> finnow <span class="sc">+</span> sex <span class="sc">+</span> age_dv, <span class="at">family =</span> binomial, <span class="at">data =</span> ukhls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the code above, we have saved the logistic regression output as an object called ‘model_logistic’, so we can perform some additional work on that model, such as getting a summary of it. Previously we have used both the <code>summary()</code> function from base <code>R</code> as well as the <code>summ()</code> function from the <code>{jtools}</code> package. This latter gives us better formatted summmaries and has several further options that will come extremely useful now wich logistic regressions; so let’s ask for a <code>summ()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>jtools<span class="sc">::</span><span class="fu">summ</span>(model_logistic, <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>MODEL INFO:
Observations: 37449 (1844 missing obs. deleted)
Dependent Variable: smoker
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(6) = 1253.769, p = 0.000
Pseudo-R² (Cragg-Uhler) = 0.058
Pseudo-R² (McFadden) = 0.040
AIC = 30034.905, BIC = 30094.620 

Standard errors: MLE
---------------------------------------------------------------
                                 Est.    S.E.    z val.       p
---------------------------- -------- ------- --------- -------
(Intercept)                     1.720   0.055    31.324   0.000
finnowDoing alright            -0.517   0.040   -12.832   0.000
finnowJust about getting       -1.007   0.043   -23.360   0.000
by                                                             
finnowFinding it quite         -1.329   0.062   -21.607   0.000
difficult                                                      
finnowFinding it very          -1.630   0.082   -19.872   0.000
difficult                                                      
sexfemale                       0.238   0.030     8.005   0.000
age_dv                          0.010   0.001    12.454   0.000
---------------------------------------------------------------</code></pre>
</div>
</div>
<section id="from-log-odds-to-odds-ratios" class="level3">
<h3 class="anchored" data-anchor-id="from-log-odds-to-odds-ratios">From <strong><em>log-odds</em></strong> to <strong><em>Odds Ratios</em></strong></h3>
<p>The coefficients (<strong>Est.</strong>imates) returned by our logit model are a bit difficult to interpret intuitively because they are measured on a strange mathematical scale called the <em>log-odds</em>, but which can be converted back to <em>probabilities</em> and <em>odds ratios</em> if we want. The advantage of <em>log odds</em> is that it follows the same logic we already know from linear regression: either an increase or a decrease of <em>x</em> value - for instance, here, being female as opposed to male is associated with 0.238 higher <em>log-odds</em> of being a <strong>non-smoker</strong> (remember that the <em>smoker</em> variable is coded such that <em>yes</em> is the first category (0) and <em>no</em> is the second category (1), so we are getting results for the probability of the second (1) category compared to the first (0), so for being <em>non-smokers</em>). But what this actually means in practice is very unclear.</p>
<p>It is more common to report <strong>odds ratios</strong> (OR) instead. An odds ratio less than 1 means that a unit increase in the value of the predictor variable leads to a <em>decrease</em> in the odds that the outcome is equal to its value 1 (being a <em>non-smoker</em> in our case). An odds ratio greater than 1 means that an increase in the predictor leads to an <em>increase</em> in the odds that the outcome is 1 (<em>non-smoker</em>). In general, the <strong>percent change</strong> in the odds given a one-unit change in the predictor can be determined as:</p>
<p><span class="math display">\[
Percent Chance in Odds = 100\times(OR-1)
\]</span></p>
<p>The <code>summ()</code> function of the <code>{jtools}</code> package makes it easier to request odds ratios (same as “<strong>exp</strong>onentiated coefficients”) with the <code>exp =</code> option:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>jtools<span class="sc">::</span><span class="fu">summ</span>(model_logistic, <span class="at">digits=</span><span class="dv">3</span>, <span class="at">exp =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre class="outputbox"><code>MODEL INFO:
Observations: 37449 (1844 missing obs. deleted)
Dependent Variable: smoker
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(6) = 1253.769, p = 0.000
Pseudo-R² (Cragg-Uhler) = 0.058
Pseudo-R² (McFadden) = 0.040
AIC = 30034.905, BIC = 30094.620 

Standard errors: MLE
--------------------------------------------------------------------------
                               exp(Est.)    2.5%   97.5%    z val.       p
---------------------------- ----------- ------- ------- --------- -------
(Intercept)                        5.583   5.013   6.217    31.324   0.000
finnowDoing alright                0.596   0.551   0.645   -12.832   0.000
finnowJust about getting           0.365   0.336   0.398   -23.360   0.000
by                                                                        
finnowFinding it quite             0.265   0.235   0.299   -21.607   0.000
difficult                                                                 
finnowFinding it very              0.196   0.167   0.230   -19.872   0.000
difficult                                                                 
sexfemale                          1.269   1.197   1.345     8.005   0.000
age_dv                             1.010   1.009   1.012    12.454   0.000
--------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>We see that we are also getting confidence intervals instead of standard errors by default, which can be again easier to interpret.</p>
<p>The <strong>‘exp(Est.)’</strong> (for “exponentiated coefficient”) estimates shown are the <strong>odds ratios</strong>, and while they look very different from what we are used to from linear regression (i.e.&nbsp;they do not take negative values but run from 0 to infinity, with anything between 0 and 1 meaning a <em>decrease</em> and anything above 1 meaning an <em>increase</em>), they are easier to interpret in terms of <em>percentage change in the odds of being a non-smoker</em>:</p>
<ul>
<li>the odds of being a non-smoker if you are a woman are 100*(1.269-1)= 26.9% higher than if you were a man;</li>
<li>the odds of being a non-smoker increase by 100*(1.010-1)= 1% with each additional year of age</li>
<li>the odds of being a non-smoker if you <em>find it very difficult</em> to manage financially as opposed to <em>Living comfortably</em> are 100*(0.196-1)= -80.4% - in other words, much lower. <strong>Remember that here the <em>living comfortably</em> variable is the <em>base</em> or <em>reference</em> level to which all other categories of ‘finnow’ compare</strong></li>
<li>and so on for the other estimates; <strong>basically, we subtract a 1 from the estimate number and move the decimal point two spots to the right to get a percentage of odds.</strong></li>
</ul>
<p>If you are the kind of person who likes betting on horse races in the weekend, the concept of <em>odds</em> will make perfect sense; the res of us can take away the main idea that we either see an <em>increase</em> or a <em>decrease</em> of a certain amount in respect to the outcome, so we gain a general understanding of how the various factor we are assessing affect the probability of the outcome (being a non-smoker).</p>
</section>
</section>
<section id="exercise-2-make-it-simple" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2-make-it-simple">Exercise 2: Make it simple</h2>
<p>We started with a complex model to get an idea of the whole picture. But it’s generally useful to have a quick look at simpler models too that only include a subset of the variables of interest. For example, it would be interesting to see what the effect of <em>financial situation</em> on <em>smoking</em> is if we <em>do not</em> also control for <em>age</em> and <em>gender</em>. Try to fit this model and check if any of the main results change significantly.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a simpler model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercise-3-on-your-own" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3-on-your-own">Exercise 3: On your own</h2>
<p>If there’s time left, chose another set of variables that can help explain a theoretically/sociologically interesting question and following the steps in Example 1,work towards fitting a logistic regression model.</p>
<p><strong>TIP</strong>: if you have looked at the Assignment 2 research question options you will know that there is a question there that can be answered using logistic regression; if you’re interested in that one, you can give it a go!</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>